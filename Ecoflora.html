<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Interaktif Flora & Fauna Indonesia</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <style>
        :root {
            --primary-color: #2e7d32;
            --secondary-color: #4caf50;
            --accent-color: #81c784;
            --text-dark: #1b5e20;
            --text-light: #f1f8e9;
            --background-light: #e8f5e9;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--background-light);
            color: #333;
        }
        
        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        
        nav a:hover, nav a.active {
            background: rgba(255,255,255,0.2);
        }
        
        .logo h1 {
            font-size: 1.8rem;
        }
        
        .logo-icon {
            font-size: 2rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .section-title {
            color: var(--text-dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent-color);
        }
        
        /* Map Controls */
        .map-controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        /* Search input */
        .search-input {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .search-input input[type="search"] {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            width: 100%;
            background: white;
        }

        .search-input button {
            padding: 10px 12px;
            border: none;
            background: var(--primary-color);
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
        }
        
        .control-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-dark);
        }
        
        .control-group select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }
        
        /* Map Container */
        .map-wrapper {
            background: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        #map {
            height: 600px;
            width: 100%;
            border-radius: 8px;
        }
        
        /* Custom Marker Popup */
        .custom-popup {
            min-width: 250px;
        }
        
        .popup-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .popup-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 5px;
        }
        
        .popup-scientific {
            font-style: italic;
            color: #666;
            margin-bottom: 10px;
        }
        
        .popup-info {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .popup-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .status-endangered {
            background: #ffcdd2;
            color: #c62828;
        }
        
        .status-vulnerable {
            background: #ffe0b2;
            color: #ef6c00;
        }
        
        .status-least-concern {
            background: #c8e6c9;
            color: #2e7d32;
        }
        
        .status-near-threatened {
            background: #fff9c4;
            color: #f57f17;
        }
        
        /* Legend */
        .map-legend {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--text-dark);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .legend-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .icon-fauna {
            background: #ff6b6b;
        }
        
        .icon-flora {
            background: #51cf66;
        }
        
        /* Statistics */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            #map {
                height: 400px;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <span class="logo-icon">ðŸŒ¿</span>
            <h1>Flora & Fauna Indonesia</h1>
        </div>
        <nav>
            <ul>
                <li><a href="#map-section" class="active">Peta Interaktif</a></li>
                <li><a href="#species-section">Daftar Spesies</a></li>
                <li><a href="#quiz-section">Kuis Edukasi</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <section id="map-section">
            <h2 class="section-title">Peta Persebaran Flora & Fauna</h2>
        
        <!-- Map Controls -->
        <div class="map-controls">
            <div class="controls-grid">
                <div class="control-group">
                    <label for="categoryFilter">Kategori</label>
                    <select id="categoryFilter">
                        <option value="all">Semua</option>
                        <option value="fauna">Fauna</option>
                        <option value="flora">Flora</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="statusFilter">Status Konservasi</label>
                    <select id="statusFilter">
                        <option value="all">Semua Status</option>
                        <option value="endangered">Terancam Punah</option>
                        <option value="vulnerable">Rentan</option>
                        <option value="near-threatened">Hampir Terancam</option>
                        <option value="least-concern">Berisiko Rendah</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="provinceFilter">Provinsi</label>
                    <select id="provinceFilter">
                        <option value="all">Semua Provinsi</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="searchInput">Cari Spesies</label>
                    <div class="search-input">
                        <input list="speciesList" id="searchInput" type="search" placeholder="Masukkan nama spesies atau provinsi...">
                        <button id="searchBtn" title="Cari">Cari</button>
                    </div>
                    <datalist id="speciesList"></datalist>
                </div>
            </div>
        </div>
        
        <!-- Map -->
        <div class="map-wrapper">
            <div id="map"></div>
        </div>
        
        <!-- Legend -->
        <div class="map-legend">
            <div class="legend-title">Keterangan</div>
            <div class="legend-item">
                <div class="legend-icon icon-fauna"></div>
                <span>Fauna (Hewan)</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon icon-flora"></div>
                <span>Flora (Tumbuhan)</span>
            </div>
        </div>
        
        <!-- Statistics -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="totalSpecies">0</div>
                <div class="stat-label">Total Spesies</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalFauna">0</div>
                <div class="stat-label">Fauna</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalFlora">0</div>
                <div class="stat-label">Flora</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalEndangered">0</div>
                <div class="stat-label">Terancam Punah</div>
            </div>
        </div>
        </section>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script>
        // Data spesies flora dan fauna Indonesia (data dummy yang lebih lengkap)
        const speciesData = [
            {
                id: 1,
                name: "Orangutan Sumatera",
                scientificName: "Pongo abelii",
                category: "fauna",
                description: "Orangutan Sumatera adalah kera besar endemik Sumatera dengan bulu coklat kemerahan panjang. Mereka hidup di kanopi hutan hujan dan memiliki perilaku semi-soliter.",
                conservationStatus: "endangered",
                habitat: "Hutan hujan tropis dataran rendah dan pegunungan",
                province: "Sumatera Utara",
                image: "https://images.unsplash.com/photo-1540573133985-87b6da6d54a9?w=400",
                location: { lat: 3.5952, lng: 98.6722 }
            },
            {
                id: 2,
                name: "Rafflesia Arnoldii",
                scientificName: "Rafflesia arnoldii",
                category: "flora",
                description: "Bunga terbesar di dunia dengan diameter mencapai 1 meter. Bunga parasit ini mengeluarkan bau busuk untuk menarik serangga penyerbuk.",
                conservationStatus: "vulnerable",
                habitat: "Hutan hujan tropis Sumatera dan Kalimantan",
                province: "Bengkulu",
                image: "https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=400",
                location: { lat: -3.7956, lng: 102.2592 }
            },
            {
                id: 3,
                name: "Badak Jawa",
                scientificName: "Rhinoceros sondaicus",
                category: "fauna",
                description: "Salah satu mamalia paling langka di dunia. Hanya tersisa sekitar 70 individu di Taman Nasional Ujung Kulon.",
                conservationStatus: "endangered",
                habitat: "Hutan hujan dataran rendah",
                province: "Banten",
                image: "https://images.unsplash.com/photo-1551069613-1904dbdcda11?w=400",
                location: { lat: -6.7825, lng: 105.3706 }
            },
            {
                id: 4,
                name: "Anggrek Bulan",
                scientificName: "Phalaenopsis amabilis",
                category: "flora",
                description: "Puspa bangsa Indonesia dengan bunga putih elegan. Anggrek epifit ini tumbuh menempel pada batang pohon.",
                conservationStatus: "least-concern",
                habitat: "Hutan hujan tropis",
                province: "Jawa Barat",
                image: "https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400",
                location: { lat: -6.9175, lng: 107.6191 }
            },
            {
                id: 5,
                name: "Komodo",
                scientificName: "Varanus komodoensis",
                category: "fauna",
                description: "Kadal terbesar di dunia yang hanya ditemukan di Indonesia. Predator puncak dengan gigitan beracun.",
                conservationStatus: "vulnerable",
                habitat: "Savana dan hutan tropis",
                province: "Nusa Tenggara Timur",
                image: "https://images.unsplash.com/photo-1564760290292-23341e4df6ec?w=400",
                location: { lat: -8.5898, lng: 119.4418 }
            },
            {
                id: 6,
                name: "Kantong Semar",
                scientificName: "Nepenthes",
                category: "flora",
                description: "Tanaman karnivora dengan kantong perangkap serangga. Indonesia memiliki lebih dari 60 spesies Nepenthes.",
                conservationStatus: "vulnerable",
                habitat: "Hutan hujan tropis dan pegunungan",
                province: "Kalimantan Barat",
                image: "https://images.unsplash.com/photo-1593199346169-53f3396e51d5?w=400",
                location: { lat: -0.2788, lng: 111.4753 }
            },
            {
                id: 7,
                name: "Jalak Bali",
                scientificName: "Leucopsar rothschildi",
                category: "fauna",
                description: "Burung endemik Bali dengan bulu putih dan topeng biru di sekitar mata. Status kritikal karena perburuan liar.",
                conservationStatus: "endangered",
                habitat: "Hutan savana dan hutan mangrove",
                province: "Bali",
                image: "https://images.unsplash.com/photo-1552728089-57bdde30beb3?w=400",
                location: { lat: -8.3405, lng: 115.0920 }
            },
            {
                id: 8,
                name: "Bunga Bangkai",
                scientificName: "Amorphophallus titanum",
                category: "flora",
                description: "Bunga tertinggi di dunia yang dapat mencapai tinggi 3 meter. Mekar sangat jarang, hanya beberapa hari.",
                conservationStatus: "vulnerable",
                habitat: "Hutan hujan tropis Sumatera",
                province: "Sumatera Barat",
                image: "https://images.unsplash.com/photo-1516253593875-bd7ba052fbc5?w=400",
                location: { lat: -0.9471, lng: 100.4172 }
            },
            {
                id: 9,
                name: "Harimau Sumatera",
                scientificName: "Panthera tigris sumatrae",
                category: "fauna",
                description: "Subspesies harimau terkecil yang hanya ada di Sumatera. Populasinya terus menurun akibat hilangnya habitat.",
                conservationStatus: "endangered",
                habitat: "Hutan hujan tropis",
                province: "Sumatera Selatan",
                image: "https://images.unsplash.com/photo-1563206767-5b18f218e8de?w=400",
                location: { lat: -2.9761, lng: 104.7754 }
            },
            {
                id: 10,
                name: "Cendrawasih",
                scientificName: "Paradisaea apoda",
                category: "fauna",
                description: "Burung surga dengan bulu yang sangat indah. Endemik Papua dan menjadi simbol keindahan alam Indonesia.",
                conservationStatus: "least-concern",
                habitat: "Hutan hujan dataran rendah dan pegunungan",
                province: "Papua",
                image: "https://images.unsplash.com/photo-1444464666168-49d633b86797?w=400",
                location: { lat: -4.2699, lng: 138.0804 }
            },
            {
                id: 11,
                name: "Edelweiss Jawa",
                scientificName: "Anaphalis javanica",
                category: "flora",
                description: "Bunga abadi yang tumbuh di pegunungan tinggi Jawa. Simbol cinta abadi dalam budaya Indonesia.",
                conservationStatus: "near-threatened",
                habitat: "Pegunungan tinggi 2000-3000 mdpl",
                province: "Jawa Tengah",
                image: "https://images.unsplash.com/photo-1582794543139-8ac9cb0f7b11?w=400",
                location: { lat: -7.2575, lng: 110.1342 }
            },
            {
                id: 12,
                name: "Tarsius",
                scientificName: "Tarsius tarsier",
                category: "fauna",
                description: "Primata terkecil di dunia dengan mata besar yang unik. Nokturnal dan endemik Sulawesi.",
                conservationStatus: "vulnerable",
                habitat: "Hutan primer dan sekunder",
                province: "Sulawesi Utara",
                image: "https://images.unsplash.com/photo-1497206365907-f5e630693df0?w=400",
                location: { lat: 1.4748, lng: 124.8421 }
            }
        ];

        // Inisialisasi peta
        let map;
        let markers = [];
        let markerLayer;
        let speciesIdToMarker = {};

        function initMap() {
            // Buat peta dengan center di Indonesia
            map = L.map('map').setView([-2.5489, 118.0149], 5);

            // Tambahkan tile layer OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 18
            }).addTo(map);

            // Use MarkerClusterGroup for clustering markers
            markerLayer = L.markerClusterGroup({ chunkedLoading: true });
            markerLayer.addTo(map);

            // Render semua marker
            renderMarkers(speciesData);

            // Update statistik
            updateStatistics(speciesData);

            // Populate province filter and search datalist
            populateProvinceFilter();
            populateSearchDatalist();
        }

        function getMarkerIcon(category, status) {
            const colors = {
                fauna: '#ff6b6b',
                flora: '#51cf66'
            };
            
            const color = colors[category] || '#666';
            
            return L.divIcon({
                html: `<div style="
                    background-color: ${color};
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    border: 3px solid white;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
                "></div>`,
                className: 'custom-marker',
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });
        }

        function getStatusText(status) {
            const statusMap = {
                'endangered': 'Terancam Punah',
                'vulnerable': 'Rentan',
                'least-concern': 'Berisiko Rendah',
                'near-threatened': 'Hampir Terancam'
            };
            return statusMap[status] || 'Tidak Diketahui';
        }

        function getStatusClass(status) {
            return `status-${status}`;
        }

        function createPopupContent(species) {
            return `
                <div class="custom-popup">
                    <img src="${species.image}" alt="${species.name}" class="popup-image">
                    <div class="popup-title">${species.name}</div>
                    <div class="popup-scientific">${species.scientificName}</div>
                    <div class="popup-info"><strong>Kategori:</strong> ${species.category === 'fauna' ? 'Fauna' : 'Flora'}</div>
                    <div class="popup-info"><strong>Provinsi:</strong> ${species.province}</div>
                    <div class="popup-info"><strong>Koordinat:</strong> ${species.location && species.location.lat ? species.location.lat.toFixed(6) : '-'}, ${species.location && species.location.lng ? species.location.lng.toFixed(6) : '-'}</div>
                    <div class="popup-info"><strong>Altitude:</strong> ${species.altitude ? species.altitude + ' m' : 'Tidak tersedia'}</div>
                    <div class="popup-info"><strong>Habitat:</strong> ${species.habitat}</div>
                    <span class="popup-status ${getStatusClass(species.conservationStatus)}">
                        ${getStatusText(species.conservationStatus)}
                    </span>
                    <p style="margin-top: 10px; font-size: 0.9rem;">${species.description}</p>
                </div>
            `;
        }

        function renderMarkers(data) {
            // Hapus semua marker yang ada
            markerLayer.clearLayers();
            markers = [];
            speciesIdToMarker = {};

            // Tambahkan marker baru (di-cluster oleh markerCluster plugin)
            data.forEach(species => {
                const marker = L.marker(
                    [species.location.lat, species.location.lng],
                    { icon: getMarkerIcon(species.category, species.conservationStatus) }
                )
                .bindPopup(createPopupContent(species), {
                    maxWidth: 300,
                    className: 'custom-popup-container'
                });

                markerLayer.addLayer(marker);
                markers.push(marker);
                speciesIdToMarker[species.id] = marker;
            });
        }

        // Populate search datalist with species names and provinces
        function populateSearchDatalist() {
            const datalist = document.getElementById('speciesList');
            datalist.innerHTML = '';

            const names = new Set();
            speciesData.forEach(s => {
                names.add(s.name);
                names.add(s.province);
            });

            Array.from(names).sort().forEach(n => {
                const option = document.createElement('option');
                option.value = n;
                datalist.appendChild(option);
            });
        }

        // Search function: find species by name or province. If multiple matches, fit bounds; if single, zoom to marker and open popup.
        function searchSpecies(query) {
            if (!query) return;
            const q = query.trim().toLowerCase();
            const matches = speciesData.filter(s => s.name.toLowerCase().includes(q) || s.province.toLowerCase().includes(q));

            if (matches.length === 0) {
                alert('Spesies atau provinsi tidak ditemukan.');
                return;
            }

            if (matches.length === 1) {
                const s = matches[0];
                const marker = speciesIdToMarker[s.id];
                if (marker) {
                    map.setView([s.location.lat, s.location.lng], 12);
                    // open popup after map animates
                    setTimeout(() => marker.openPopup(), 300);
                }
                return;
            }

            // Multiple matches: fit bounds of their markers
            const latlngs = matches.map(s => [s.location.lat, s.location.lng]);
            const bounds = L.latLngBounds(latlngs);
            map.fitBounds(bounds.pad(0.25));
        }

        function filterSpecies() {
            const category = document.getElementById('categoryFilter').value;
            const status = document.getElementById('statusFilter').value;
            const province = document.getElementById('provinceFilter').value;
            
            const filtered = speciesData.filter(species => {
                const matchCategory = category === 'all' || species.category === category;
                const matchStatus = status === 'all' || species.conservationStatus === status;
                const matchProvince = province === 'all' || species.province === province;
                
                return matchCategory && matchStatus && matchProvince;
            });
            
            renderMarkers(filtered);
            updateStatistics(filtered);
        }

        function updateStatistics(data) {
            const totalSpecies = data.length;
            const totalFauna = data.filter(s => s.category === 'fauna').length;
            const totalFlora = data.filter(s => s.category === 'flora').length;
            const totalEndangered = data.filter(s => s.conservationStatus === 'endangered').length;
            
            document.getElementById('totalSpecies').textContent = totalSpecies;
            document.getElementById('totalFauna').textContent = totalFauna;
            document.getElementById('totalFlora').textContent = totalFlora;
            document.getElementById('totalEndangered').textContent = totalEndangered;
        }

        function populateProvinceFilter() {
            const provinces = [...new Set(speciesData.map(s => s.province))].sort();
            const select = document.getElementById('provinceFilter');
            
            provinces.forEach(province => {
                const option = document.createElement('option');
                option.value = province;
                option.textContent = province;
                select.appendChild(option);
            });
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            
            document.getElementById('categoryFilter').addEventListener('change', filterSpecies);
            document.getElementById('statusFilter').addEventListener('change', filterSpecies);
            document.getElementById('provinceFilter').addEventListener('change', filterSpecies);
            
            // Search listeners
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            if (searchBtn) searchBtn.addEventListener('click', () => searchSpecies(searchInput.value));
            if (searchInput) searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    searchSpecies(searchInput.value);
                }
            });
            
            // Smooth scroll untuk navigasi
            document.querySelectorAll('nav a').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Hapus kelas active dari semua link
                    document.querySelectorAll('nav a').forEach(link => {
                        link.classList.remove('active');
                    });
                    
                    // Tambahkan kelas active ke link yang diklik
                    this.classList.add('active');
                    
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>